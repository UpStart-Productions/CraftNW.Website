---
import { ShoppingBag, Instagram } from "lucide-astro";

const currentPath = Astro.url.pathname;

const navItems = [
  { name: "Home", href: "/" },
  { name: "Products", href: "/products" },
  { name: "About", href: "/about" },
  { name: "Contact", href: "/contact" },
];
---

<header id="main-header" class="fixed top-0 left-0 right-0 z-50 bg-craft-white border-b border-craft-warm-gray transition-all duration-300">
  <nav class="container-craft">
    <div id="header-content" class="flex items-center justify-between py-4 md:py-6 transition-all duration-300">
      <!-- Logo -->
      <a href="/" class="flex items-center relative">
        <img
          id="logo-large"
          src="/images/branding/logo-standard.svg"
          alt="CraftNW"
          class="h-24 md:h-30 w-auto transition-all duration-300"
        />
        <img
          id="logo-small"
          src="/images/branding/logo-small.png"
          alt="CraftNW"
          class="h-16 w-auto absolute top-0 left-0 opacity-0 transition-all duration-300"
        />
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden md:flex items-center space-x-12">
        {
          navItems.map((item) => {
            const isActive = 
              (item.href === "/" && currentPath === "/") ||
              (item.href !== "/" && currentPath.startsWith(item.href));
            
            return (
              <a
                href={item.href}
                class={`nav-link text-craft-black hover:text-craft-red transition-colors font-medium text-lg ${
                  isActive ? "active" : ""
                }`}
              >
                {item.name}
              </a>
            );
          })
        }
      </div>

      <!-- Social Icons -->
      <div class="hidden md:flex items-center gap-4">
        <a
          href="https://www.etsy.com/shop/CraftNWDesigns"
          target="_blank"
          rel="noopener noreferrer"
          class="text-craft-black hover:text-craft-red transition-colors"
          aria-label="Etsy Shop"
        >
          <ShoppingBag class="w-6 h-6" />
        </a>
        <a
          href="https://www.instagram.com/craft_nw/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-craft-black hover:text-craft-red transition-colors"
          aria-label="Instagram"
        >
          <Instagram class="w-6 h-6" />
        </a>
        <a
          href="https://www.pinterest.com/CraftNWDesigns/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-craft-black hover:text-craft-red transition-colors"
          aria-label="Pinterest"
        >
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 0c-6.627 0-12 5.372-12 12 0 5.084 3.163 9.426 7.627 11.174-.105-.949-.2-2.405.042-3.441.218-.937 1.407-5.965 1.407-5.965s-.359-.719-.359-1.782c0-1.668.967-2.914 2.171-2.914 1.023 0 1.518.769 1.518 1.69 0 1.029-.655 2.568-.994 3.995-.283 1.194.599 2.169 1.777 2.169 2.133 0 3.772-2.249 3.772-5.495 0-2.873-2.064-4.882-5.012-4.882-3.414 0-5.418 2.561-5.418 5.207 0 1.031.397 2.138.893 2.738.098.119.112.224.083.345l-.333 1.36c-.053.22-.174.267-.402.161-1.499-.698-2.436-2.889-2.436-4.649 0-3.785 2.75-7.262 7.929-7.262 4.163 0 7.398 2.967 7.398 6.931 0 4.136-2.607 7.464-6.227 7.464-1.216 0-2.359-.631-2.75-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146 1.124.347 2.317.535 3.554.535 6.627 0 12-5.373 12-12 0-6.628-5.373-12-12-12z"/>
          </svg>
        </a>
        <a
          href="https://www.behance.net/chiefupstart"
          target="_blank"
          rel="noopener noreferrer"
          class="text-craft-black hover:text-craft-red transition-colors"
          aria-label="Behance"
        >
          <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
            <path d="M22 7h-7v-2h7v2zm1.726 10c-.442 1.297-2.029 3-5.101 3-3.074 0-5.564-1.729-5.564-5.675 0-3.91 2.325-5.92 5.466-5.92 3.082 0 4.964 1.782 5.375 4.426.078.506.109 1.188.095 2.14h-8.027c.13 3.211 3.483 3.312 4.588 2.029h3.168zm-7.686-4h4.965c-.105-1.547-1.136-2.219-2.477-2.219-1.466 0-2.277.768-2.488 2.219zm-9.574 6.988h-6.466v-14.967h6.953c5.476.081 5.58 5.444 2.72 6.906 3.461 1.26 3.577 8.061-3.207 8.061zm-3.466-8.988h3.584c2.508 0 2.906-3-.312-3h-3.272v3zm3.391 3h-3.391v3.016h3.341c3.055 0 2.868-3.016.05-3.016z"/>
          </svg>
        </a>
      </div>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-button"
        class="md:hidden p-2 text-craft-black hover:text-craft-red transition-colors"
        aria-label="Toggle menu"
      >
        <svg
          id="hamburger-icon"
          class="w-7 h-7 transition-all duration-300"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        <svg
          id="close-icon"
          class="w-7 h-7 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 transition-all duration-300 opacity-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div
    id="mobile-menu"
    class="hidden md:hidden bg-craft-white border-t border-craft-warm-gray"
  >
    <div class="container-craft py-6 space-y-4">
      {
        navItems.map((item) => (
          <a
            href={item.href}
            class="block text-craft-black hover:text-craft-red transition-colors font-medium text-lg py-2"
          >
            {item.name}
          </a>
        ))
      }
      <a
        href="/products"
        class="btn-primary w-full mt-4 flex items-center justify-center gap-2"
      >
        <ShoppingBag class="w-5 h-5" />
        <span>Products</span>
      </a>
    </div>
  </div>
</header>

<style>
  .nav-link {
    position: relative;
    padding-bottom: 4px;
  }

  .nav-link::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: var(--craft-red);
    transition: width 0.3s ease;
  }

  .nav-link:hover::after,
  .nav-link.active::after {
    width: 100%;
  }

  .nav-link.active {
    color: var(--craft-red);
  }
</style>

<script>
  const menuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");
  const hamburgerIcon = document.getElementById("hamburger-icon");
  const closeIcon = document.getElementById("close-icon");

  menuButton?.addEventListener("click", () => {
    const isHidden = mobileMenu?.classList.contains("hidden");
    
    if (isHidden) {
      mobileMenu?.classList.remove("hidden");
      if (hamburgerIcon && closeIcon) {
        hamburgerIcon.style.opacity = "0";
        closeIcon.style.opacity = "1";
      }
    } else {
      mobileMenu?.classList.add("hidden");
      if (hamburgerIcon && closeIcon) {
        hamburgerIcon.style.opacity = "1";
        closeIcon.style.opacity = "0";
      }
    }
  });

  // Scroll detection for header shrinking
  const header = document.getElementById("main-header");
  const headerContent = document.getElementById("header-content");
  const logoLarge = document.getElementById("logo-large");
  const logoSmall = document.getElementById("logo-small");
  
  let lastScrollY = window.scrollY;
  let isScrollingDown = false;
  let isShrunken = false;

  function handleScroll() {
    const currentScrollY = window.scrollY;
    
    // Determine scroll direction
    isScrollingDown = currentScrollY > lastScrollY;
    lastScrollY = currentScrollY;

    // Shrink when scrolling down and past a certain threshold
    const shouldShrink = currentScrollY > 100;

    if (shouldShrink && !isShrunken) {
      // Shrink header
      isShrunken = true;
      if (headerContent) {
        headerContent.style.paddingTop = "0.5rem";
        headerContent.style.paddingBottom = "0.5rem";
      }
      if (logoLarge) {
        logoLarge.style.opacity = "0";
        logoLarge.style.height = "0";
      }
      if (logoSmall) {
        logoSmall.style.opacity = "1";
        logoSmall.style.position = "relative";
      }
    } else if (!shouldShrink && isShrunken) {
      // Expand header back to normal
      isShrunken = false;
      if (headerContent) {
        headerContent.style.paddingTop = "";
        headerContent.style.paddingBottom = "";
      }
      if (logoLarge) {
        logoLarge.style.opacity = "1";
        logoLarge.style.height = "";
      }
      if (logoSmall) {
        logoSmall.style.opacity = "0";
        logoSmall.style.position = "absolute";
      }
    }
  }

  // Throttle scroll events for better performance
  let scrollTimeout: number | undefined;
  window.addEventListener("scroll", () => {
    if (scrollTimeout) {
      window.cancelAnimationFrame(scrollTimeout);
    }
    scrollTimeout = window.requestAnimationFrame(handleScroll);
  });
</script>

